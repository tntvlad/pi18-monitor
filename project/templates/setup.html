<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P18 Inverter Monitor - Setup</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/setup.css') }}">
</head>
<body>
    <header>
        <h1>P18 Inverter Monitor - Setup</h1>
    </header>
    
    <main>
        <div class="setup-container">
            <section class="dashboard-card">
                <h2>Connection Settings</h2>
                
                {% if success_message %}
                <div class="alert success">
                    {{ success_message }}
                </div>
                {% endif %}
                
                {% if error_message %}
                <div class="alert error">
                    {{ error_message }}
                </div>
                {% endif %}
                
                <form action="{{ url_for('setup') }}" method="POST" class="setup-form">
                    <div class="form-group">
                        <label for="port">Serial Port</label>
                        <input type="text" id="port" name="port" value="{{ config.INVERTER_PORT }}" required>
                        <small>Example: /dev/ttyUSB0, COM3, etc.</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="baudrate">Baud Rate</label>
                        <select id="baudrate" name="baudrate">
                            <option value="1200" {% if config.INVERTER_BAUDRATE == 1200 %}selected{% endif %}>1200</option>
                            <option value="2400" {% if config.INVERTER_BAUDRATE == 2400 %}selected{% endif %}>2400</option>
                            <option value="4800" {% if config.INVERTER_BAUDRATE == 4800 %}selected{% endif %}>4800</option>
                            <option value="9600" {% if config.INVERTER_BAUDRATE == 9600 %}selected{% endif %}>9600</option>
                            <option value="19200" {% if config.INVERTER_BAUDRATE == 19200 %}selected{% endif %}>19200</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="timeout">Timeout (seconds)</label>
                        <input type="number" id="timeout" name="timeout" min="1" max="10" step="1" value="{{ config.INVERTER_TIMEOUT }}">
                    </div>
                    
                    <h3>Advanced Settings</h3>
                    
                    <div class="form-group">
                        <label for="refresh_interval">Dashboard Refresh Interval (seconds)</label>
                        <input type="number" id="refresh_interval" name="refresh_interval" min="5" max="300" step="5" value="{{ config.DASHBOARD_REFRESH_INTERVAL }}">
                    </div>
                    
                    <div class="form-group">
                        <label for="log_level">Log Level</label>
                        <select id="log_level" name="log_level">
                            <option value="DEBUG" {% if config.LOG_LEVEL == 'DEBUG' %}selected{% endif %}>Debug</option>
                            <option value="INFO" {% if config.LOG_LEVEL == 'INFO' %}selected{% endif %}>Info</option>
                            <option value="WARNING" {% if config.LOG_LEVEL == 'WARNING' %}selected{% endif %}>Warning</option>
                            <option value="ERROR" {% if config.LOG_LEVEL == 'ERROR' %}selected{% endif %}>Error</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn primary">Save Settings</button>
                        <a href="{{ url_for('index') }}" class="btn secondary">Back to Dashboard</a>
                    </div>
                </form>
            </section>
            
            <section class="dashboard-card">
                <h2>Connection Test</h2>
                <div class="connection-test">
                    <p>Test your connection to the inverter:</p>
                    <button id="test-connection" class="btn secondary">Test Connection</button>
                    <div id="test-result" class="test-result"></div>
                </div>
            </section>
            
            <section class="dashboard-card">
                <h2>Available Serial Ports</h2>
                <div id="serial-ports" class="serial-ports">
                    <p>Loading available ports...</p>
                </div>
            </section>
        </div>
    </main>
    
    <footer>
        <p>P18 Inverter Monitoring System &copy; 2023</p>
        <p><small>Version 1.0.0</small></p>
    </footer>
    
    <script src="{{ url_for('static', filename='js/setup.js') }}"></script>
</body>
</html>